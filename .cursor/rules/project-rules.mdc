---
description: Основные правила проекта AI ROI Calculator для всех AI-агентов
globs: **/*
alwaysApply: true
---

# AI ROI Calculator — правила для агентов

## Контекст проекта

Это веб-сервис для расчёта ROI внедрения ИИ-решений в бизнес-процессы.
Стек: Next.js 14 (App Router) + TypeScript + Tailwind CSS + shadcn/ui + Prisma + SQLite + Recharts.

## Обязательные документы

**ОБЯЗАТЕЛЬНО** прочитай перед началом ЛЮБОЙ задачи (без исключений):
- `README.md` — обзор проекта, стек, структура, правила разработки, деплой
- `docs/PRODUCT_SPEC.md` — полная продуктовая спецификация
- `docs/DEVELOPMENT_PLAN.md` — план фаз разработки, текущий статус
- `docs/DATA_MODEL.md` — модель данных и Prisma schema

Не приступай к реализации, пока не прочитал все четыре документа. Это необходимо для понимания контекста, актуального состояния кода и принятых решений.

## Правила кодирования

### Язык
- Код (переменные, функции, комментарии, git) — на английском
- UI-тексты (лейблы, подсказки, заголовки) — на русском
- Коммиты — на русском, формат: `тип: описание`

### TypeScript
- Strict mode, избегать `any`
- Все типы в `src/types/`
- Использовать Prisma-генерируемые типы где возможно

### Компоненты
- Функциональные компоненты, React hooks
- shadcn/ui для всех UI-элементов (Button, Input, Table, Card, Dialog и т.д.)
- Tailwind CSS для стилей, никаких CSS-модулей или inline-стилей
- Файлы компонентов: `kebab-case.tsx`

### Архитектура
- Бизнес-логика расчётов → `src/lib/calculations/` (чистые функции)
- API-роуты → `src/app/api/` (тонкие, делегируют в `src/lib/`)
- Prisma client → `src/lib/db.ts` (singleton)
- Вычисляемые поля (stepCost, unitCost, unitTime и т.д.) считаются на клиенте, не хранятся в БД

### Формулы

Экономия на процессе = Σ(удельная стоимость AS-IS) − Σ(удельная стоимость TO-BE)
Стоимость этапа = цена_часа × время_часы + доп_затраты
Удельная стоимость = стоимость_этапа × доля_выполнения
ROI = (Накопленная_выгода − CAPEX) / (CAPEX + Накопленный_OPEX) × 100%

### Графики (Recharts)
- Использовать ResponsiveContainer для адаптивности
- Цветовая палитра: зелёный (#10B981) для выгоды, красный (#EF4444) для затрат, синий (#3B82F6) для процессов
- Обязательные Tooltip, Legend, реперные точки
- Не перегружать — максимум 3-4 линии/области на график

### Сохранение данных
- Автосохранение: debounced PUT (500ms) при любом изменении
- ID расчётов сохраняются в localStorage
- Расчёт доступен по ссылке `/{calculationId}`

### Безопасность
- Админ-токен → переменная окружения `ADMIN_SECRET_TOKEN`
- Не хардкодить секреты
- Валидировать входящие данные в API

## Чего НЕ делать
- Не добавлять авторизацию пользователей
- Не оптимизировать под мобильные (пока)
- Не добавлять экспорт PDF/Excel (бэклог)
- Не добавлять мультиязычность
- Не менять структуру папок без обновления README
