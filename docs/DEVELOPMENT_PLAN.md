# План разработки: AI ROI Calculator

## Обзор фаз

| Фаза | Название | Приоритет | Оценка |
|------|----------|-----------|--------|
| 1 | Инициализация проекта | P0 | 1 сессия |
| 2 | Модель данных и API | P0 | 1–2 сессии |
| 3 | Калькулятор — ввод данных | P0 | 2–3 сессии |
| 4 | Расчёты и графики | P0 | 2 сессии |
| 5 | Библиотека и история | P1 | 1–2 сессии |
| 6 | Админ-панель | P1 | 1 сессия |
| 7 | Деплой на Timeweb | P1 | 1 сессия |
| 8 | Полировка | P2 | 1–2 сессии |

---

## Фаза 1: Инициализация проекта

### Задачи
- [ ] Создать Next.js 14 проект с TypeScript и App Router
- [ ] Настроить Tailwind CSS
- [ ] Установить и настроить shadcn/ui
- [ ] Установить Prisma + SQLite
- [ ] Установить Recharts
- [ ] Создать базовый layout (header, footer, контейнер)
- [ ] Настроить структуру папок согласно README
- [ ] Создать главную страницу (landing)

### Результат
Работающий скелет приложения с главной страницей, навигацией и пустым калькулятором.

---

## Фаза 2: Модель данных и API

### Задачи
- [ ] Описать Prisma schema (см. DATA_MODEL.md)
- [ ] Создать миграции
- [ ] Реализовать API-роуты:
  - `POST /api/calculations` — создать расчёт
  - `GET /api/calculations/:id` — получить расчёт
  - `PUT /api/calculations/:id` — обновить расчёт
  - `DELETE /api/calculations/:id` — удалить расчёт
  - `GET /api/templates` — список шаблонов
  - `GET /api/templates/:id` — получить шаблон
- [ ] Создать TypeScript типы в `src/types/`
- [ ] Создать Prisma client singleton в `src/lib/db.ts`

### Результат
Полностью рабочий бэкенд с CRUD для расчётов и шаблонов.

---

## Фаза 3: Калькулятор — ввод данных

### Задачи
- [ ] Создать компонент stepper/tabs навигации по шагам
- [ ] Шаг 1: Таблица процесса AS-IS
  - Динамическое добавление/удаление строк
  - Автовычисление: стоимость шага, удельное время, удельная стоимость
  - Итоговая строка
- [ ] Шаг 2: Таблица процесса TO-BE
  - Кнопка «Скопировать из AS-IS»
  - Те же вычисления
- [ ] Шаг 3: Таблица ошибок AS-IS
- [ ] Шаг 4: Таблица ошибок TO-BE
  - Кнопка «Скопировать из AS-IS»
- [ ] Шаг 5: Форма динамики раскатки
  - Выбор модели (radio/select)
  - Поля параметров
  - Превью кривой раскатки (мини-график)
- [ ] Шаг 6: Таблица CAPEX
- [ ] Шаг 7: Таблица OPEX
- [ ] Автосохранение (debounced PUT при изменениях)
- [ ] Редактируемое название расчёта

### Результат
Полностью рабочий ввод данных по всем шагам калькулятора с автовычислением и автосохранением.

---

## Фаза 4: Расчёты и графики

### Задачи
- [ ] Реализовать модуль расчётов в `src/lib/calculations/`:
  - `process-savings.ts` — экономия на процессе
  - `error-savings.ts` — экономия на ошибках
  - `rollout.ts` — кривые раскатки (linear, s-curve, instant)
  - `roi.ts` — помесячный ROI, накопленная выгода, точка окупаемости
- [ ] Шаг 8: Экран результатов
  - Ключевые метрики (карточки):
    - ROI за 12 месяцев
    - Точка окупаемости (месяц)
    - Суммарная экономия за год
    - Экономия времени за операцию
  - График 1: Динамика окупаемости (area chart)
  - График 2: Помесячная экономия (stacked bar)
  - График 3: Кривая раскатки (line chart)
  - График 4: Сравнение AS-IS vs TO-BE (bar chart)
- [ ] Настройка горизонта расчёта (12/24/36 месяцев)
- [ ] Responsive графики

### Результат
Полный расчёт ROI с четырьмя информативными графиками и ключевыми метриками.

---

## Фаза 5: Библиотека и история

### Задачи
- [ ] Страница «Библиотека шаблонов» (`/templates`)
  - Карточки с названием, описанием, отраслью
  - Фильтрация по категории
  - Кнопка «Использовать» — создаёт расчёт из шаблона
- [ ] Страница «Мои расчёты» (`/my`)
  - Список расчётов из localStorage (ID + название + дата)
  - Загрузка деталей с сервера
  - Удаление из списка
- [ ] Сохранение ID расчётов в localStorage
- [ ] Возможность дать расчёту название
- [ ] Кнопка «Скопировать ссылку» на странице расчёта

### Результат
Пользователь может находить свои прошлые расчёты и использовать готовые шаблоны.

---

## Фаза 6: Админ-панель

### Задачи
- [ ] Страница `/admin/{token}` (токен из env)
- [ ] Список шаблонов с CRUD
- [ ] Форма создания/редактирования шаблона:
  - Название, описание, отрасль
  - Таблица этапов AS-IS (без стоимостных полей)
  - Таблица этапов TO-BE (без стоимостных полей)
  - Таблица ошибок AS-IS (без стоимостей)
  - Таблица ошибок TO-BE (без стоимостей)
  - Статьи CAPEX/OPEX (без сумм)
  - Модель раскатки по умолчанию
- [ ] API-роуты для админа:
  - `POST /api/admin/templates` (с проверкой токена)
  - `PUT /api/admin/templates/:id`
  - `DELETE /api/admin/templates/:id`
- [ ] Публикация/снятие с публикации шаблона

### Результат
Администратор может управлять библиотекой шаблонов через веб-интерфейс.

---

## Фаза 7: Деплой на Timeweb

### Задачи
- [ ] Создать VPS на Timeweb (Ubuntu 22.04, минимальный тариф)
- [ ] Установить Node.js 20 LTS (через nvm)
- [ ] Установить PM2 для управления процессом
- [ ] Установить и настроить Nginx:
  ```nginx
  server {
      listen 80;
      location / {
          proxy_pass http://localhost:3000;
          proxy_http_version 1.1;
          proxy_set_header Upgrade $http_upgrade;
          proxy_set_header Connection 'upgrade';
          proxy_set_header Host $host;
          proxy_cache_bypass $http_upgrade;
      }
  }
  ```
- [ ] Клонировать репозиторий на сервер
- [ ] Настроить `.env` (ADMIN_TOKEN, DATABASE_URL)
- [ ] Собрать проект (`npm run build`)
- [ ] Запустить через PM2 (`pm2 start npm --name roi -- start`)
- [ ] Настроить автозапуск PM2 при перезагрузке

### Скрипт деплоя
```bash
#!/bin/bash
# deploy.sh — запускать на сервере
cd /opt/ai-roi-calculator
git pull origin main
npm ci
npx prisma db push
npm run build
pm2 restart roi
```

### Результат
Приложение доступно по IP-адресу сервера, работает стабильно через PM2 + Nginx.

---

## Фаза 8: Полировка

### Задачи
- [ ] Пустые состояния (нет расчётов, нет шаблонов)
- [ ] Валидация ввода (отрицательные числа, пустые поля)
- [ ] Подсказки и tooltips для полей
- [ ] Loading-состояния
- [ ] Обработка ошибок API
- [ ] Мета-теги и favicon
- [ ] Финальная проверка на планшете
- [ ] Оптимизация bundle size

### Результат
Продакшн-готовое приложение с хорошим UX.

---

## Будущие улучшения (бэклог)

- [ ] Экспорт в PDF
- [ ] Экспорт в Excel
- [ ] Мультиязычность
- [ ] OAuth авторизация
- [ ] Командная работа (совместное редактирование)
- [ ] Мобильная адаптация
- [ ] Домен и SSL (Let's Encrypt)
- [ ] Аналитика использования
